<!DOCTYPE html> 
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Админ-панель | whylovly</title>
  
  <!-- CSP мета-тег -->
  <meta http-equiv="Content-Security-Policy" content="
      default-src * 'unsafe-inline' 'unsafe-eval' data: blob:;
      connect-src 'self' https://*.googleapis.com https://*.firebaseio.com https://identitytoolkit.googleapis.com;
      frame-src 'self' https://*.firebaseapp.com https://accounts.google.com https://*.google.com;
      img-src 'self' data: https://* blob:;
      script-src 'self' 'unsafe-inline' 'unsafe-eval' https://*.firebaseapp.com https://*.googleapis.com https://*.google.com https://*.gstatic.com">
  
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  
  <style>
      :root {
          --neon-color: #00ffcc;
          --bg-dark: #121212;
          --bg-card: rgba(0, 0, 0, 0.3);
          --text-color: #ffffff;
          --error-color: #ff4444;
      }

      body {
          font-family: 'Roboto', sans-serif;
          background: var(--bg-dark);
          color: var(--text-color);
          margin: 0;
          padding: 20px;
          min-height: 100vh;
          display: flex;
          justify-content: center;
          align-items: center;
      }

      #loginForm {
          text-align: center;
          max-width: 400px;
          margin: 50px auto;
          padding: 30px;
          background: var(--bg-card);
          border-radius: 12px;
          border: 1px solid var(--neon-color);
          box-shadow: 0 0 30px rgba(0, 255, 204, 0.2);
      }

      #googleSignIn {
          background: var(--neon-color);
          color: var(--bg-dark);
          padding: 12px 24px;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          font-weight: 500;
          transition: all 0.3s ease;
          width: 200px;
          margin-top: 20px;
      }

      #googleSignIn:hover {
          opacity: 0.9;
          transform: translateY(-2px);
      }

      #adminContent {
          width: 100%;
          max-width: 1200px;
          margin: 0 auto;
          padding: 20px;
          display: none;
      }

      .error {
          color: var(--error-color);
          margin: 10px 0;
          padding: 10px;
          border-radius: 4px;
          background: rgba(255, 68, 68, 0.1);
      }

      .admin-header {
          display: flex;
          align-items: center;
          gap: 20px;
          padding: 20px;
          background: var(--bg-card);
          border-radius: 15px;
          border: 1px solid var(--neon-color);
          margin-bottom: 30px;
      }

      .profile-photo {
          width: 80px;
          height: 80px;
          border-radius: 50%;
          object-fit: cover;
          border: 2px solid var(--neon-color);
      }

      .profile-info h2 {
          margin: 0;
          color: var(--neon-color);
      }

      .profile-info p {
          margin: 5px 0;
          opacity: 0.8;
      }

      .admin-tabs {
          display: flex;
          justify-content: center;
          gap: 15px;
          margin-bottom: 30px;
          flex-wrap: wrap;
      }

      .tab-button {
          background: var(--bg-card);
          border: 1px solid var(--neon-color);
          color: var(--text-color);
          padding: 12px 24px;
          border-radius: 8px;
          cursor: pointer;
          transition: all 0.3s ease;
          font-weight: 500;
          min-width: 150px;
      }

      .tab-button:hover {
          background: rgba(0, 255, 204, 0.1);
          transform: translateY(-2px);
      }

      .tab-button.active {
          background: var(--neon-color);
          color: var(--bg-dark);
      }

      .form-group {
          background: var(--bg-card);
          padding: 25px;
          border-radius: 12px;
          margin-bottom: 20px;
          border: 1px solid var(--neon-color);
          box-shadow: 0 0 20px rgba(0, 255, 204, 0.1);
      }

      .preview-container {
          margin: 15px 0;
          max-width: 300px;
          border-radius: 8px;
          overflow: hidden;
      }

      .preview-container img {
          width: 100%;
          height: auto;
          border-radius: 8px;
      }

      .preview-container audio {
          width: 100%;
          margin: 10px 0;
      }

      .video-preview {
          position: relative;
          width: 100%;
          padding-bottom: 56.25%;
          background: #000;
          border-radius: 8px;
          overflow: hidden;
      }

      .video-preview img {
          position: absolute;
          width: 100%;
          height: 100%;
          object-fit: cover;
      }

      .video-preview .play-icon {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          font-size: 48px;
          color: white;
          text-shadow: 0 0 10px rgba(0,0,0,0.5);
      }
      h3 {
          color: var(--neon-color);
          margin-top: 0;
          font-size: 1.5em;
          margin-bottom: 20px;
      }

      label {
          display: block;
          margin: 15px 0 8px;
          color: var(--text-color);
          font-weight: 500;
      }

      select, input, textarea {
          width: 100%;
          padding: 12px;
          background: rgba(255, 255, 255, 0.1);
          border: 1px solid var(--neon-color);
          color: var(--text-color);
          border-radius: 8px;
          font-family: inherit;
          transition: all 0.3s ease;
      }

      select:focus, input:focus, textarea:focus {
          outline: none;
          box-shadow: 0 0 0 2px rgba(0, 255, 204, 0.3);
      }

      button {
          background: var(--neon-color);
          color: var(--bg-dark);
          padding: 12px 24px;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          width: 100%;
          font-weight: 500;
          transition: all 0.3s ease;
      }

      button:hover {
          opacity: 0.9;
          transform: translateY(-2px);
      }

      button:disabled {
          opacity: 0.5;
          cursor: not-allowed;
          transform: none;
      }

      .progress-bar {
          height: 6px;
          background: rgba(255, 255, 255, 0.1);
          margin: 20px 0;
          border-radius: 3px;
          overflow: hidden;
      }

      .progress {
          height: 100%;
          background: var(--neon-color);
          width: 0%;
          transition: width 0.3s ease;
      }

      .post-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
          gap: 20px;
          margin-top: 20px;
      }

      .post-item {
          background: var(--bg-card);
          border: 1px solid var(--neon-color);
          border-radius: 12px;
          overflow: hidden;
          transition: transform 0.3s ease;
      }

      .post-item:hover {
          transform: translateY(-5px);
      }

      .post-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 15px;
          border-bottom: 1px solid rgba(0, 255, 204, 0.2);
      }

      .post-content {
          padding: 15px;
      }

      .post-media {
          width: 100%;
          height: 200px;
          object-fit: cover;
      }

      .delete-btn {
          background: var(--error-color);
          padding: 8px 16px;
          width: auto;
          margin: 0;
          color: white;
      }

      @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
      }

      @media (max-width: 768px) {
          body {
              padding: 10px;
          }
          
          .admin-tabs {
              flex-direction: column;
          }
          
          .tab-button {
              width: 100%;
          }
      }
/* Стили для статистики */
.stats-block {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.stat-item {
    background: var(--bg-card);
    border: 1px solid var(--neon-color);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
}

.stat-number {
    font-size: 2.5em;
    color: var(--neon-color);
    margin: 10px 0;
}

.stat-item h4 {
    margin: 0;
    color: var(--text-color);
    opacity: 0.8;
}
.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.comments-list {
    margin-top: 20px;
}

.comment-item {
    background: var(--bg-card);
    border: 1px solid var(--neon-color);
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
}

.comment-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
}

.comment-author {
    color: var(--neon-color);
    font-weight: 500;
}

.comment-date {
    opacity: 0.7;
}

.comment-text {
    margin: 0;
}
.detailed-stats {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
    margin-top: 20px;
}

.post-stats {
    background: var(--bg-card);
    border: 1px solid var(--neon-color);
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
}

.visitor-item {
    background: var(--bg-card);
    border: 1px solid var(--neon-color);
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 15px;
}

.visitor-photo {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
}

.visitor-info {
    flex-grow: 1;
}

.visitor-email {
    color: var(--neon-color);
    font-weight: 500;
}

.visitor-date {
    opacity: 0.7;
    font-size: 0.9em;
}
    .activity-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}

.activity-tab {
    background: var(--bg-card);
    border: 1px solid var(--neon-color);
    color: var(--text-color);
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
}

.activity-tab.active {
    background: var(--neon-color);
    color: var(--bg-dark);
}

.detailed-stats {
    margin-top: 20px;
}

.post-stat-item {
    background: var(--bg-card);
    border: 1px solid var(--neon-color);
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
}

.post-stat-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
}

.post-stat-details {
    margin-top: 10px;
}

.user-activity-item {
    background: var(--bg-card);
    border: 1px solid var(--neon-color);
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 15px;
}

.user-photo {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
}

.activity-info {
    flex-grow: 1;
}

.activity-date {
    color: var(--neon-color);
    font-size: 0.9em;
}

.loading {
    text-align: center;
    padding: 20px;
    color: var(--neon-color);
}

.no-data {
    text-align: center;
    padding: 20px;
    color: var(--text-color);
    opacity: 0.7;
}

.activity-details {
    margin-top: 5px;
}

.comment-text {
    margin: 5px 0;
    padding: 5px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.user-name {
    color: var(--neon-color);
    font-weight: 500;
}

.logout-btn {
    background: var(--error-color);
    color: white;
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-left: auto;
    width: auto;
}

.logout-btn:hover {
    opacity: 0.9;
}
  </style>
</head>
<body>
    <div id="loginForm">
        <h2>Вход в админ-панель</h2>
        <button id="googleSignIn">Войти через Google</button>
    </div>

    <div id="adminContent" style="display: none;">
        <div class="admin-header">
            <img id="currentProfilePhoto" src="" alt="Profile" class="profile-photo">
            <div class="profile-info">
                <h2 id="currentProfileName">whylovly</h2>
                <p id="currentProfileBio">Музыкант | Создатель контента | Артист</p>
            </div>
            <button onclick="signOut()" class="logout-btn">Выйти</button>
        </div>

        <div class="admin-tabs">
    <button class="tab-button active" onclick="showTab('posts')">Добавить пост</button>
    <button class="tab-button" onclick="showTab('manage')">Управление постами</button>
    <button class="tab-button" onclick="showTab('stats')">Статистика</button>  <!-- Новая кнопка -->
    <button class="tab-button" onclick="showTab('profile')">Профиль</button>
    <button class="tab-button" onclick="showTab('settings')">Настройки</button>
</div>

        <div id="posts" class="tab-content active">
            <div class="form-group">
                <h3>Добавить новый пост</h3>
                <form id="uploadForm">
                    <label for="category">Категория:</label>
                    <select id="category" required>
                        <option value="photo">Фото</option>
                        <option value="music">Музыка</option>
                        <option value="video">Видео</option>
                    </select>

                    <div id="fileInputGroup">
                        <label for="fileInput">Файл:</label>
                        <input type="file" id="fileInput">
                        <div class="preview-container" id="filePreview"></div>
                    </div>

                    <div id="youtubeLinkGroup" style="display: none;">
                        <label for="youtubeLink">Ссылка на YouTube:</label>
                        <input type="url" id="youtubeLink" placeholder="https://youtube.com/...">
                        <div class="preview-container" id="youtubePreview"></div>
                    </div>

                    <label for="description">Описание:</label>
                    <textarea id="description" rows="4" required></textarea>

                    <div class="progress-bar">
                        <div class="progress"></div>
                    </div>

                    <button type="submit">Опубликовать</button>
                </form>
            </div>
        </div>

        <div id="manage" class="tab-content">
            <div class="form-group">
                <h3>Управление постами</h3>
                <div class="post-grid" id="postsList">
                    <div class="loading">Загрузка постов...</div>
                </div>
            </div>
        </div>
        <div id="profile" class="tab-content">
            <div class="form-group">
                <h3>Настройки профиля</h3>
                <form id="profileForm">
                    <div class="profile-upload">
                        <label for="profilePhoto">Фото профиля:</label>
                        <input type="file" id="profilePhoto" accept="image/*">
                        <div class="preview-container" id="profilePreview">
                            <img id="currentProfilePhotoPreview" src="" alt="Preview">
                        </div>
                    </div>

                    <label for="profileName">Имя профиля:</label>
                    <input type="text" id="profileName" required>

                    <label for="profileBio">Описание профиля:</label>
                    <textarea id="profileBio" rows="3" required></textarea>

                   <div class="social-links-group">
    <h4>Социальные сети</h4>
    <div id="socialLinksContainer">
        <div class="social-link-item">
            <label for="instagram">Instagram:</label>
            <input type="url" id="instagram" name="instagram" placeholder="https://instagram.com/...">
        </div>
        
        <div class="social-link-item">
            <label for="youtube">YouTube:</label>
            <input type="url" id="youtube" name="youtube" placeholder="https://youtube.com/...">
        </div>
        
        <div class="social-link-item">
            <label for="vk">VK:</label>
            <input type="url" id="vk" name="vk" placeholder="https://vk.com/...">
        </div>
    </div>
</div>

                    <button type="submit">Сохранить изменения</button>
                </form>
            </div>
        </div>

        <div id="settings" class="tab-content">
            <div class="form-group">
                <h3>Общие настройки</h3>
                <form id="settingsForm">
                    <label for="siteTitle">Заголовок сайта:</label>
                    <input type="text" id="siteTitle" required>

                    <label for="accentColor">Цвет акцента:</label>
                    <input type="color" id="accentColor" value="#00ffcc">

                    <label for="headerImage">Фоновое изображение шапки:</label>
                    <input type="file" id="headerImage" accept="image/*">
                    <div class="preview-container" id="headerPreview"></div>

                    <div class="form-group">
                        <h4>Настройки главной страницы</h4>
                        <label for="welcomeText">Приветственный текст:</label>
                        <textarea id="welcomeText" rows="3"></textarea>

                        <label for="featuredContent">Закрепленный контент:</label>
                        <select id="featuredContent">
                            <option value="">Не выбрано</option>
                        </select>
                    </div>

                    <button type="submit">Применить настройки</button>
                </form>
            </div>
        </div>
    </div>
<div id="stats" class="tab-content">
    <div class="form-group">
        <h3>Общая статистика</h3>
        <div class="stats-block">
            <div class="stat-item">
                <h4>Всего постов</h4>
                <div id="totalPosts" class="stat-number">0</div>
            </div>
            <div class="stat-item">
                <h4>Всего лайков</h4>
                <div id="totalLikes" class="stat-number">0</div>
            </div>
            <div class="stat-item">
                <h4>Комментариев</h4>
                <div id="totalComments" class="stat-number">0</div>
            </div>
            <div class="stat-item">
                <h4>Посетителей</h4>
                <div id="totalVisitors" class="stat-number">0</div>
            </div>
        </div>

        <!-- Детальная статистика по постам -->
        <label for="post-category">Категория:</label>
        <select id="post-category" required>
            <option value="photo">Фото</option>
            <option value="music">Музыка</option>
            <option value="video">Видео</option>
        </select>

        <div id="fileInputGroup">
            <label for="post-file">Файл:</label>
            <input type="file" id="post-file">
            <div class="preview-container" id="filePreview"></div>
        </div>

        <div id="youtubeLinkGroup" style="display: none;">
            <label for="post-youtube">Ссылка на YouTube:</label>
            <input type="url" id="post-youtube" placeholder="https://youtube.com/...">
            <div class="preview-container" id="youtubePreview"></div>
        </div>

        <label for="post-description">Описание:</label>
        <textarea id="post-description" rows="4" required></textarea>

        <div class="progress-bar">
            <div class="progress"></div>
        </div>

        <button type="submit">Опубликовать</button>
    </form>
</div>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, getDocs, deleteDoc, doc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDPMqef3_hF-QpBr09qtry_45K4h28oMT0",
            authDomain: "whylovly-website-8adcb.firebaseapp.com",
            projectId: "whylovly-website-8adcb",
            storageBucket: "whylovly-website-8adcb.appspot.com",
            messagingSenderId: "749833792533",
            appId: "1:749833792533:web:2494649a11b628cd84321c"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore(app);

        // Функция для переключения табов
        window.showTab = function(tabId) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
        };

        // Добавляем обработчики для табов
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                showTab(button.dataset.tab);
            });
        });

        // Функция загрузки статистики
        async function loadStats() {
            try {
                const postsSnapshot = await getDocs(collection(db, 'posts'));
                const likesSnapshot = await getDocs(collection(db, 'likes'));
                const commentsSnapshot = await getDocs(collection(db, 'comments'));
                const visitsSnapshot = await getDocs(collection(db, 'visits'));

                document.getElementById('totalPosts').textContent = postsSnapshot.size;
                document.getElementById('totalLikes').textContent = likesSnapshot.size;
                document.getElementById('totalComments').textContent = commentsSnapshot.size;
                document.getElementById('totalVisitors').textContent = visitsSnapshot.size;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Функция загрузки постов
        async function loadPosts() {
            try {
                const postsSnapshot = await getDocs(collection(db, 'posts'));
                const postList = document.getElementById('postsList');
                postList.innerHTML = '';

                postsSnapshot.forEach(doc => {
                    const post = doc.data();
                    const postElement = document.createElement('div');
                    postElement.className = 'post-card';
                    postElement.innerHTML = `
                        <h3>${post.title || 'Без названия'}</h3>
                        <p>${post.description || ''}</p>
                        <button class="delete-btn" onclick="deletePost('${doc.id}')">Удалить</button>
                    `;
                    postList.appendChild(postElement);
                });
            } catch (error) {
                console.error('Error loading posts:', error);
            }
        }

        // Функция удаления поста
        window.deletePost = async (postId) => {
            if (confirm('Вы уверены, что хотите удалить этот пост?')) {
                try {
                    await deleteDoc(doc(db, 'posts', postId));
                    loadPosts();
                    loadStats();
                } catch (error) {
                    console.error('Error deleting post:', error);
                    alert('Ошибка при удалении поста');
                }
            }
        };

        // Обработчик входа
        document.getElementById('googleSignIn').onclick = async () => {
            try {
                const provider = new GoogleAuthProvider();
                provider.setCustomParameters({ prompt: 'select_account' });
                const result = await signInWithPopup(auth, provider);
                
                if (result.user.email === 'iosinniy1@gmail.com') {
                    document.getElementById('loginForm').style.display = 'none';
                    document.getElementById('adminContent').style.display = 'block';
                    loadStats();
                    loadPosts();
                } else {
                    await signOut(auth);
                    alert('Доступ запрещен. Используйте аккаунт администратора.');
                }
            } catch (error) {
                if (error.code !== 'auth/popup-closed-by-user') {
                    console.error('Login error:', error);
                    alert('Ошибка входа: ' + error.message);
                }
            }
        };

        // Слушатель состояния авторизации
        auth.onAuthStateChanged((user) => {
            if (user && user.email === 'iosinniy1@gmail.com') {
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                loadStats();
                loadPosts();
            } else {
                document.getElementById('loginForm').style.display = 'block';
                document.getElementById('adminContent').style.display = 'none';
            }
        });
    </script>
</body>
</html>
