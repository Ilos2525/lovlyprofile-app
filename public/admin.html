// ... existing code ...
<script type="module">
    // Обновляем импорты Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Обновленная конфигурация Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyAo5uvpI2B5p2GXLfWXZ29V-Z9cGD8wJ6U",
        authDomain: "whylovly-website.firebaseapp.com",
        projectId: "whylovly-website",
        storageBucket: "whylovly-website-8adcb.appspot.com", // Обновленный bucket
        messagingSenderId: "679128641326",
        appId: "1:679128641326:web:27fe6fa6cd6f1e986cd4bf",
        measurementId: "G-RFQRS6K1SX"
    };

    // Инициализация Firebase
    const app = initializeApp(firebaseConfig);
    const storage = getStorage(app);
    const db = getFirestore(app);

    // Добавляем обработку ошибок и логирование
    document.getElementById("uploadForm").addEventListener("submit", async function(event) {
        event.preventDefault();
        
        try {
            const category = document.getElementById("category").value;
            const fileInput = document.getElementById("fileInput");
            const youtubeLink = document.getElementById("youtubeLink").value;
            const description = document.getElementById("description").value;

            console.log("Начало загрузки:", { category, youtubeLink, description });

            let fileURL = "";
            let fileName = "";

            if (category === "video" && youtubeLink) {
                fileURL = youtubeLink;
                console.log("Добавление видео:", fileURL);
            } else if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                fileName = `${Date.now()}_${file.name}`; // Уникальное имя файла
                const storageRef = ref(storage, `${category}/${fileName}`);
                
                console.log("Загрузка файла в Storage...");
                const snapshot = await uploadBytes(storageRef, file);
                console.log("Файл загружен:", snapshot);
                
                fileURL = await getDownloadURL(storageRef);
                console.log("Получен URL файла:", fileURL);
            } else {
                throw new Error("Выберите файл или вставьте YouTube ссылку!");
            }

            // Сохраняем информацию в Firestore
            const postData = {
                category,
                fileName,
                fileURL,
                description,
                timestamp: new Date().toISOString(),
                likes: 0,
                comments: []
            };

            console.log("Сохранение в Firestore:", postData);
            const docRef = await addDoc(collection(db, category), postData);
            console.log("Документ сохранен с ID:", docRef.id);

            alert("Пост успешно загружен!");
            document.getElementById("uploadForm").reset();

        } catch (error) {
            console.error("Ошибка при загрузке:", error);
            alert(`Ошибка: ${error.message}`);
        }
    });
</script>
