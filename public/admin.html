<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self' https://*.firebaseapp.com https://*.googleapis.com https://*.google.com https://*.gstatic.com https://ritrag.com; 
        script-src 'self' 'unsafe-inline' 'unsafe-eval' https://*.firebaseapp.com https://*.googleapis.com https://*.google.com https://ritrag.com; 
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; 
        font-src 'self' https://fonts.gstatic.com; 
        img-src 'self' data: https://* blob:; 
        connect-src 'self' https://*.firebaseio.com https://*.googleapis.com https://*.google.com https://identitytoolkit.googleapis.com wss://*.firebaseio.com;">
    <title>Админ-панель | whylovly</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
        <div id="profile" class="tab-content">
            <div class="form-group">
                <h3>Настройки профиля</h3>
                <form id="profileForm">
                    <div class="profile-upload">
                        <label for="profilePhoto">Фото профиля:</label>
                        <input type="file" id="profilePhoto" accept="image/*">
                        <div class="preview-container" id="profilePreview">
                            <img id="currentProfilePhotoPreview" src="" alt="Preview">
                        </div>
                    </div>

                    <label for="profileName">Имя профиля:</label>
                    <input type="text" id="profileName" required>

                    <label for="profileBio">Описание профиля:</label>
                    <textarea id="profileBio" rows="3" required></textarea>

                    <label for="profileLinks">Социальные сети:</label>
                    <div id="socialLinks">
                        <input type="url" placeholder="Instagram" name="instagram">
                        <input type="url" placeholder="YouTube" name="youtube">
                        <input type="url" placeholder="VK" name="vk">
                    </div>

                    <button type="submit">Сохранить изменения</button>
                </form>
            </div>
        </div>

        <div id="settings" class="tab-content">
            <div class="form-group">
                <h3>Общие настройки</h3>
                <form id="settingsForm">
                    <label for="siteTitle">Заголовок сайта:</label>
                    <input type="text" id="siteTitle" required>

                    <label for="accentColor">Цвет акцента:</label>
                    <input type="color" id="accentColor" value="#00ffcc">

                    <label for="headerImage">Фоновое изображение шапки:</label>
                    <input type="file" id="headerImage" accept="image/*">
                    <div class="preview-container" id="headerPreview"></div>

                    <div class="form-group">
                        <h4>Настройки главной страницы</h4>
                        <label for="welcomeText">Приветственный текст:</label>
                        <textarea id="welcomeText" rows="3"></textarea>

                        <label for="featuredContent">Закрепленный контент:</label>
                        <select id="featuredContent">
                            <option value="">Не выбрано</option>
                        </select>
                    </div>

                    <button type="submit">Применить настройки</button>
                </form>
            </div>
        </div>
    </div>
<body>
    <div id="loginForm">
        <h3>Вход в админ-панель</h3>
        <button id="googleSignIn">Войти через Google</button>
    </div>

    <div id="adminContent" style="display: none;">
        <div class="admin-header">
            <img id="currentProfilePhoto" src="" alt="Profile" class="profile-photo">
            <div class="profile-info">
                <h2 id="currentProfileName">whylovly</h2>
                <p id="currentProfileBio">Музыкант | Создатель контента | Артист</p>
            </div>
        </div>

        <div class="admin-tabs">
            <button class="tab-button active" onclick="showTab('posts')">Добавить пост</button>
            <button class="tab-button" onclick="showTab('manage')">Управление постами</button>
            <button class="tab-button" onclick="showTab('stats')">Статистика</button>
            <button class="tab-button" onclick="showTab('profile')">Профиль</button>
            <button class="tab-button" onclick="showTab('settings')">Настройки</button>
        </div>
        <div id="posts" class="tab-content active">
            <div class="form-group">
                <h3>Добавить новый пост</h3>
                <form id="uploadForm">
                    <label for="category">Категория:</label>
                    <select id="category" required>
                        <option value="photo">Фото</option>
                        <option value="music">Музыка</option>
                        <option value="video">Видео</option>
                    </select>

                    <div id="fileInputGroup">
                        <label for="fileInput">Файл:</label>
                        <input type="file" id="fileInput">
                        <div class="preview-container" id="filePreview"></div>
                    </div>

                    <div id="youtubeLinkGroup" style="display: none;">
                        <label for="youtubeLink">Ссылка на YouTube:</label>
                        <input type="url" id="youtubeLink" placeholder="https://youtube.com/...">
                        <div class="preview-container" id="youtubePreview"></div>
                    </div>

                    <label for="description">Описание:</label>
                    <textarea id="description" rows="4" required></textarea>

                    <div class="progress-bar">
                        <div class="progress"></div>
                    </div>

                    <button type="submit">Опубликовать</button>
                </form>
            </div>
        </div>

        <div id="manage" class="tab-content">
            <div class="form-group">
                <h3>Управление постами</h3>
                <div class="post-grid" id="postsList">
                    <div class="loading">Загрузка постов...</div>
                </div>
            </div>
        </div>

        <div id="stats" class="tab-content">
            <div class="form-group">
                <h3>Общая статистика</h3>
                <div class="stats-block">
                    <div class="stat-item">
                        <h4>Всего постов</h4>
                        <div id="totalPosts" class="stat-number">0</div>
                    </div>
                    <div class="stat-item">
                        <h4>Всего лайков</h4>
                        <div id="totalLikes" class="stat-number">0</div>
                    </div>
                    <div class="stat-item">
                        <h4>Комментариев</h4>
                        <div id="totalComments" class="stat-number">0</div>
                    </div>
                    <div class="stat-item">
                        <h4>Посетителей</h4>
                        <div id="totalVisitors" class="stat-number">0</div>
                    </div>
                </div>
                <div id="detailedPostStats" class="detailed-stats">
                    <!-- Здесь будет детальная статистика -->
                </div>
            </div>
        </div>
        <div id="profile" class="tab-content">
            <div class="form-group">
                <h3>Настройки профиля</h3>
                <form id="profileForm">
                    <div class="profile-upload">
                        <label for="profilePhoto">Фото профиля:</label>
                        <input type="file" id="profilePhoto" accept="image/*">
                        <div class="preview-container" id="profilePreview">
                            <img id="currentProfilePhotoPreview" src="" alt="Preview">
                        </div>
                    </div>

                    <label for="profileName">Имя профиля:</label>
                    <input type="text" id="profileName" required>

                    <label for="profileBio">Описание профиля:</label>
                    <textarea id="profileBio" rows="3" required></textarea>

                    <label for="profileLinks">Социальные сети:</label>
                    <div id="socialLinks">
                        <input type="url" placeholder="Instagram" name="instagram">
                        <input type="url" placeholder="YouTube" name="youtube">
                        <input type="url" placeholder="VK" name="vk">
                    </div>

                    <button type="submit">Сохранить изменения</button>
                </form>
            </div>
        </div>

        <div id="settings" class="tab-content">
            <div class="form-group">
                <h3>Общие настройки</h3>
                <form id="settingsForm">
                    <label for="siteTitle">Заголовок сайта:</label>
                    <input type="text" id="siteTitle" required>

                    <label for="accentColor">Цвет акцента:</label>
                    <input type="color" id="accentColor" value="#00ffcc">

                    <label for="headerImage">Фоновое изображение шапки:</label>
                    <input type="file" id="headerImage" accept="image/*">
                    <div class="preview-container" id="headerPreview"></div>

                    <div class="form-group">
                        <h4>Настройки главной страницы</h4>
                        <label for="welcomeText">Приветственный текст:</label>
                        <textarea id="welcomeText" rows="3"></textarea>

                        <label for="featuredContent">Закрепленный контент:</label>
                        <select id="featuredContent">
                            <option value="">Не выбрано</option>
                        </select>
                    </div>

                    <button type="submit">Применить настройки</button>
                </form>
            </div>
        </div>
    </div>
<script type="module">
    // Firebase импорты
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { 
        getAuth, 
        GoogleAuthProvider, 
        signInWithPopup,
        onAuthStateChanged,
        setPersistence,
        browserLocalPersistence
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { 
        getFirestore,
        collection, 
        addDoc,
        getDocs,
        deleteDoc,
        doc,
        getDoc,
        setDoc,
        query, 
        orderBy,
        writeBatch 
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import {
        getStorage,
        ref,
        uploadBytesResumable,
        getDownloadURL
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

    // Конфигурация Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyDPMqef3_hF-QpBr09qtry_45K4h28oMT0",
        authDomain: "whylovly-website-8adcb.firebaseapp.com",
        projectId: "whylovly-website-8adcb",
        storageBucket: "whylovly-website-8adcb.appspot.com",
        messagingSenderId: "749833792533",
        appId: "1:749833792533:web:2494649a11b628cd84321c",
        measurementId: "G-0MKF0C3WQJ"
    };

    // Инициализация Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // Установка локального хранения
    setPersistence(auth, browserLocalPersistence)
        .then(() => console.log("Persistence set to LOCAL"))
        .catch((error) => console.error("Error setting persistence:", error));

    // Основные функции
    function getYoutubeVideoId(url) {
        const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
        const match = url.match(regExp);
        return (match && match[2].length === 11) ? match[2] : null;
    }

    function generateYoutubePreview(videoId) {
        return `
            <div class="video-preview">
                <img src="https://img.youtube.com/vi/${videoId}/maxresdefault.jpg" alt="YouTube Preview">
                <div class="play-icon">▶️</div>
            </div>
        `;
    }
    // Обработчик входа через Google
    document.getElementById('googleSignIn').addEventListener('click', async function() {
        try {
            const provider = new GoogleAuthProvider();
            provider.setCustomParameters({
                prompt: 'select_account'
            });
            
            const result = await signInWithPopup(auth, provider);
            
            if (result.user.email === 'iosinniy1@gmail.com') {
                console.log("✅ Успешный вход админа");
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                loadProfile();
            } else {
                console.log("❌ Неверный email:", result.user.email);
                await auth.signOut();
                alert('Доступ запрещен. Только администратор может войти в панель управления.');
            }
        } catch (error) {
            console.error("❌ Ошибка входа:", error);
            alert(`Ошибка входа: ${error.message}`);
        }
    });

    // Проверка состояния авторизации
    onAuthStateChanged(auth, (user) => {
        if (user && user.email === 'iosinniy1@gmail.com') {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('adminContent').style.display = 'block';
            loadProfile();
        } else {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('adminContent').style.display = 'none';
        }
    });

    // Функция загрузки файла
    async function uploadFile(file, category) {
        return new Promise((resolve, reject) => {
            const timestamp = Date.now();
            const storageRef = ref(storage, `${category}/${timestamp}_${file.name}`);
            const uploadTask = uploadBytesResumable(storageRef, file);
            const progressBar = document.querySelector('.progress');

            uploadTask.on('state_changed',
                (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    progressBar.style.width = progress + '%';
                },
                (error) => {
                    console.error('Ошибка загрузки:', error);
                    reject(error);
                },
                async () => {
                    try {
                        const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
                        resolve(downloadURL);
                    } catch (error) {
                        reject(error);
                    }
                }
            );
        });
    }

    // Обработчики предпросмотра файлов
    document.getElementById('fileInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        const preview = document.getElementById('filePreview');
        
        if (file) {
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                };
                reader.readAsDataURL(file);
            } else if (file.type.startsWith('audio/')) {
                preview.innerHTML = `
                    <audio controls>
                        <source src="${URL.createObjectURL(file)}" type="${file.type}">
                    </audio>`;
            }
        }
    });

    // Обработчик YouTube ссылок
    document.getElementById('youtubeLink').addEventListener('input', function(e) {
        const videoId = getYoutubeVideoId(e.target.value);
        const preview = document.getElementById('youtubePreview');
        if (videoId) {
            preview.innerHTML = generateYoutubePreview(videoId);
        } else {
            preview.innerHTML = '';
        }
    });
    // Функция переключения табов
    window.showTab = function(tabId) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        document.querySelectorAll('.tab-button').forEach(button => {
            button.classList.remove('active');
        });
        document.getElementById(tabId).classList.add('active');
        document.querySelector(`[onclick="showTab('${tabId}')"]`).classList.add('active');
        
        // Загрузка данных при переключении табов
        if (tabId === 'manage') {
            loadPosts();
        }
        if (tabId === 'stats') {
            loadStats();
        }
    };

    // Обработчик категории поста
    document.getElementById('category').addEventListener('change', function(e) {
        const isVideo = e.target.value === 'video';
        document.getElementById('fileInputGroup').style.display = isVideo ? 'none' : 'block';
        document.getElementById('youtubeLinkGroup').style.display = isVideo ? 'block' : 'none';
        document.getElementById('filePreview').innerHTML = '';
        document.getElementById('youtubePreview').innerHTML = '';
    });

    // Обработчик формы загрузки поста
    document.getElementById('uploadForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const submitButton = this.querySelector('button[type="submit"]');
        const progressBar = document.querySelector('.progress');

        try {
            submitButton.disabled = true;
            progressBar.style.width = '10%';

            const category = document.getElementById('category').value;
            const description = document.getElementById('description').value;
            let fileURL = '';

            if (category === 'video') {
                fileURL = document.getElementById('youtubeLink').value;
                if (!fileURL) throw new Error('Укажите ссылку на YouTube');
                if (!getYoutubeVideoId(fileURL)) throw new Error('Неверная ссылка на YouTube');
            } else {
                const fileInput = document.getElementById('fileInput');
                if (!fileInput.files.length) throw new Error('Выберите файл');
                
                const file = fileInput.files[0];
                fileURL = await uploadFile(file, category);
            }

            progressBar.style.width = '80%';

            await addDoc(collection(db, 'posts'), {
                category,
                fileURL,
                description,
                timestamp: new Date().toISOString(),
                author: auth.currentUser.email
            });
            
            progressBar.style.width = '100%';
            alert('Пост успешно опубликован!');
            loadStats();
            
            this.reset();
            document.getElementById('filePreview').innerHTML = '';
            document.getElementById('youtubePreview').innerHTML = '';

        } catch (error) {
            console.error('Ошибка:', error);
            alert(`Ошибка: ${error.message}`);
        } finally {
            submitButton.disabled = false;
            setTimeout(() => {
                progressBar.style.width = '0%';
            }, 1000);
        }
    });

    // Функция загрузки постов
    async function loadPosts() {
        const postsList = document.getElementById('postsList');
        try {
            const q = query(collection(db, 'posts'), orderBy('timestamp', 'desc'));
            const querySnapshot = await getDocs(q);
            
            if (querySnapshot.empty) {
                postsList.innerHTML = '<div class="post-item">Нет постов</div>';
                return;
            }

            const postsHTML = querySnapshot.docs.map(doc => {
                const post = doc.data();
                const date = new Date(post.timestamp).toLocaleString('ru-RU');
                let mediaPreview = '';
                
                switch(post.category) {
                    case 'photo':
                        mediaPreview = `<img src="${post.fileURL}" alt="Photo" class="post-media">`;
                        break;
                    case 'video':
                        const videoId = getYoutubeVideoId(post.fileURL);
                        mediaPreview = generateYoutubePreview(videoId);
                        break;
                    case 'music':
                        mediaPreview = `
                            <audio controls class="post-media">
                                <source src="${post.fileURL}" type="audio/mpeg">
                            </audio>`;
                        break;
                }

                return `
                    <div class="post-item">
                        <div class="post-header">
                            <div class="post-info">
                                <span class="post-category">${post.category}</span>
                                <span class="post-date">${date}</span>
                            </div>
                            <button class="delete-btn" onclick="deletePost('${doc.id}')">Удалить</button>
                        </div>
                        <div class="post-content">
                            ${mediaPreview}
                            <p class="post-description">${post.description}</p>
                        </div>
                    </div>
                `;
            }).join('');

            postsList.innerHTML = postsHTML;
        } catch (error) {
            console.error('Ошибка загрузки постов:', error);
            postsList.innerHTML = '<div class="post-item">Ошибка загрузки постов</div>';
        }
    }

    // Функция удаления поста
    window.deletePost = async function(postId) {
        if (!confirm('Вы уверены, что хотите удалить этот пост?')) {
            return;
        }

        try {
            await deleteDoc(doc(db, 'posts', postId));
            alert('Пост удален!');
            loadPosts();
            loadStats();
        } catch (error) {
            console.error('Ошибка удаления поста:', error);
            alert('Ошибка удаления поста: ' + error.message);
        }
    };
    // Функция загрузки статистики
    async function loadStats() {
        try {
            const [postsSnapshot, likesSnapshot, commentsSnapshot, visitorsSnapshot] = await Promise.all([
                getDocs(collection(db, 'posts')),
                getDocs(collection(db, 'likes')),
                getDocs(collection(db, 'comments')),
                getDocs(collection(db, 'visitors'))
            ]);

            // Обновляем счетчики
            document.getElementById('totalPosts').textContent = postsSnapshot.size;
            document.getElementById('totalLikes').textContent = likesSnapshot.size;
            document.getElementById('totalComments').textContent = commentsSnapshot.size;
            document.getElementById('totalVisitors').textContent = visitorsSnapshot.size;

            // Создаем детальную статистику по постам
            const postsMap = new Map();
            postsSnapshot.docs.forEach(doc => {
                const data = doc.data();
                const timestamp = data.timestamp ? new Date(data.timestamp) : new Date();
                postsMap.set(doc.id, { 
                    ...data, 
                    id: doc.id, 
                    timestamp: timestamp,
                    likes: [], 
                    comments: [] 
                });
            });

            // Добавляем информацию о лайках
            likesSnapshot.docs.forEach(doc => {
                const like = doc.data();
                if (postsMap.has(like.postId)) {
                    const timestamp = like.timestamp ? new Date(like.timestamp) : new Date();
                    postsMap.get(like.postId).likes.push({
                        userId: like.userId,
                        timestamp: timestamp,
                        userEmail: like.userEmail || 'Гость'
                    });
                }
            });

            // Добавляем информацию о комментариях
            commentsSnapshot.docs.forEach(doc => {
                const comment = doc.data();
                if (postsMap.has(comment.postId)) {
                    const timestamp = comment.timestamp ? new Date(comment.timestamp) : new Date();
                    postsMap.get(comment.postId).comments.push({
                        author: comment.author || 'Гость',
                        text: comment.text,
                        timestamp: timestamp
                    });
                }
            });

            // Отображаем детальную статистику
            const detailedStats = document.getElementById('detailedPostStats');
            let statsHTML = '';

            postsMap.forEach(post => {
                const date = post.timestamp.toLocaleString('ru-RU');
                statsHTML += `
                    <div class="post-stat-item">
                        <div class="post-stat-header">
                            <div class="post-title">${post.description ? post.description.substring(0, 50) + '...' : 'Без описания'}</div>
                            <div class="post-date">${date}</div>
                        </div>
                        <div class="post-stat-details">
                            <div>Лайков: ${post.likes.length}</div>
                            <div>Комментариев: ${post.comments.length}</div>
                            ${post.likes.length > 0 ? `
                                <div class="likes-details">
                                    <small>Последние лайки:</small>
                                    ${post.likes.slice(0, 3).map(like => `
                                        <div>${like.userEmail} - ${like.timestamp.toLocaleString('ru-RU')}</div>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            });

            detailedStats.innerHTML = statsHTML;

        } catch (error) {
            console.error('Ошибка загрузки статистики:', error);
        }
    }

    // Функция загрузки профиля
    async function loadProfile() {
        try {
            const profileDoc = await getDoc(doc(db, 'profiles', '5794174511'));
            if (profileDoc.exists()) {
                const data = profileDoc.data();
                document.getElementById('currentProfileName').textContent = data.first_name || 'whylovly';
                document.getElementById('currentProfileBio').textContent = data.bio || '';
                document.getElementById('profileName').value = data.first_name || 'whylovly';
                document.getElementById('profileBio').value = data.bio || '';
                
                if (data.photo_url) {
                    document.getElementById('currentProfilePhoto').src = data.photo_url;
                    document.getElementById('currentProfilePhotoPreview').src = data.photo_url;
                }

                // Загрузка социальных сетей
                if (data.social) {
                    Object.entries(data.social).forEach(([network, url]) => {
                        const input = document.querySelector(`input[name="${network}"]`);
                        if (input) input.value = url || '';
                    });
                }
            }
        } catch (error) {
            console.error('Ошибка загрузки профиля:', error);
        }
    }
    // Обработчик формы профиля
    document.getElementById('profileForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        try {
            const profilePhoto = document.getElementById('profilePhoto').files[0];
            const profileName = document.getElementById('profileName').value;
            const profileBio = document.getElementById('profileBio').value;
            
            let photoURL = '';
            if (profilePhoto) {
                photoURL = await uploadFile(profilePhoto, 'profile');
            }

            // Собираем данные социальных сетей
            const social = {};
            document.querySelectorAll('#socialLinks input').forEach(input => {
                if (input.value) {
                    social[input.name] = input.value;
                }
            });

            const profileData = {
                first_name: profileName,
                bio: profileBio,
                social,
                updatedAt: new Date().toISOString()
            };

            if (photoURL) {
                profileData.photo_url = photoURL;
            }

            await setDoc(doc(db, 'profiles', '5794174511'), profileData, { merge: true });
            
            // Обновляем отображение в шапке
            document.getElementById('currentProfileName').textContent = profileName;
            document.getElementById('currentProfileBio').textContent = profileBio;
            if (photoURL) {
                document.getElementById('currentProfilePhoto').src = photoURL;
            }

            alert('Профиль обновлен!');
        } catch (error) {
            console.error('Ошибка обновления профиля:', error);
            alert(`Ошибка: ${error.message}`);
        }
    });

    // Загрузка настроек
    async function loadSettings() {
        try {
            const settingsDoc = await getDoc(doc(db, 'settings', 'main'));
            if (settingsDoc.exists()) {
                const data = settingsDoc.data();
                document.getElementById('siteTitle').value = data.title || '';
                document.getElementById('accentColor').value = data.accentColor || '#00ffcc';
                document.getElementById('welcomeText').value = data.welcomeText || '';
                
                if (data.headerImageUrl) {
                    document.getElementById('headerPreview').innerHTML = 
                        `<img src="${data.headerImageUrl}" alt="Header Preview">`;
                }
            }
        } catch (error) {
            console.error('Ошибка загрузки настроек:', error);
        }
    }

    // Обработчик формы настроек
    document.getElementById('settingsForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        try {
            const headerImage = document.getElementById('headerImage').files[0];
            let headerImageUrl = '';
            
            if (headerImage) {
                headerImageUrl = await uploadFile(headerImage, 'settings');
            }

            const settingsData = {
                title: document.getElementById('siteTitle').value,
                accentColor: document.getElementById('accentColor').value,
                welcomeText: document.getElementById('welcomeText').value,
                updatedAt: new Date().toISOString()
            };

            if (headerImageUrl) {
                settingsData.headerImageUrl = headerImageUrl;
            }

            await setDoc(doc(db, 'settings', 'main'), settingsData, { merge: true });
            alert('Настройки сохранены!');
        } catch (error) {
            console.error('Ошибка сохранения настроек:', error);
            alert(`Ошибка: ${error.message}`);
        }
    });

    // Загружаем настройки при инициализации
    loadSettings();

</script>
</body>
</html>
